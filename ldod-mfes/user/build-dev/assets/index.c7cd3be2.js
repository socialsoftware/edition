import{createElement as a,createFragment as C}from"http://localhost:9000/ldod-mfes/shared/vanilla-jsx.js";import{getPartialStorage as f,Store as b}from"http://localhost:9000/ldod-mfes/shared/store.js";import{fetcher as l}from"http://localhost:9000/ldod-mfes/shared/fetcher.js";import{navigateTo as m}from"http://localhost:9000/ldod-mfes/shared/router.js";const T=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};T();const k={token:f("ldod-store","token")??void 0,language:f("ldod-store","language")??void 0,user:void 0,index:0},E=new b(k),g=()=>E.getState(),h=t=>E.setState(t),q=()=>`${g().user.firstName} ${g().user.lastName}`,$=()=>(h({index:g().index+1}),g().index),A="modulepreload",P=function(t){return"/"+t},v={},d=function(e,s,r){return!s||s.length===0?e():Promise.all(s.map(n=>{if(n=P(n),n in v)return;v[n]=!0;const o=n.endsWith(".css"),u=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${u}`))return;const i=document.createElement("link");if(i.rel=o?"stylesheet":A,o||(i.as="script",i.crossOrigin=""),i.href=n,document.head.appendChild(i),o)return new Promise((_,S)=>{i.addEventListener("load",_),i.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())},O=(t,e)=>{const s=t[e];return s?typeof s=="function"?s():Promise.resolve(s):new Promise((r,n)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+e)))})};function G(t,e){const s=t.parentElement,r=s.querySelector("small");s.className="form-control invalid",r.innerText=e}function J(t){const e=t.parentElement;e.className="form-control valid"}function Q(t){return t.slice(0,1).toUpperCase().concat(t.slice(1,t.length))}const X=(t,e="message")=>window.dispatchEvent(new CustomEvent(`ldod-${e}`,{detail:{message:t}})),M=async t=>(await O(Object.assign({"./resources/messages-en.js":()=>d(()=>import("./messages-en.f31c5a0e.js"),[]),"./resources/messages-es.js":()=>d(()=>import("./messages-es.3f00bc88.js"),[]),"./resources/messages-pt.js":()=>d(()=>import("./messages-pt.b16582a5.js"),[])}),`./resources/messages-${t}.js`)).default;function p(t,e={},s=window){const r=new CustomEvent(t,e);s.dispatchEvent(r)}const c="http://localhost:8000/api",Y=async t=>await l.post(`${c}/auth/signin`,t).then(({accessToken:e})=>w(e)),R=async t=>await l.get(`${c}/user`,null,t).then(e=>N(e)).catch(e=>console.error(e)),Z=async t=>await l.post(`${c}/auth/signup`,t),ee=async(t,e)=>l.post(`${c}/auth/${t}`,e).then(s=>{if(U(s))return m("/user/signup",globalThis,s),Promise.resolve({message:"googleAssociation"});I(s)&&w(s.accessToken)}),te=async t=>await l.get(`${c}/auth/signup${t}`),ne=async t=>l.post(`${c}/auth/change-password`,t).then(e=>(m("/"),Promise.resolve(e)));function I(t){return Object.keys(t).some(e=>e==="accessToken"||e==="tokenType")}function U(t){return Object?.keys(t).some(e=>e==="socialId")}function w(t){h({token:t}),p("ldod-token",{detail:{token:t}}),R(t),m("/")}function H(){h({token:"",user:""}),p("ldod-logout"),m("/user/signin")}function N(t){h({user:t}),p("ldod-login",{detail:{user:t}})}function j(){return a("a",{is:"nav-to",id:"login",class:"login update-language",to:"/user/signin"})}const x=()=>a(C,null,a("a",{id:"login",class:"dropdown-toggle"},q(),a("span",{class:"caret"})),a("ul",{class:"dropdown-menu"},a("li",null,a("a",{class:"update-language",id:"logout"})),a("li",null,a("a",{is:"nav-to",class:"update-language",id:"change-password",to:"/user/change-password"}))));class L extends HTMLLIElement{constructor(){super(),this.updateComponent=this.updateComponent.bind(this),this.id=`user-component-${$()}`}get language(){return this.getAttribute("language")??"en"}set language(e){this.setAttribute("language",e)}static get observedAttributes(){return["language"]}async connectedCallback(){await this.setConstants(),this.render()}attributeChangedCallback(e,s,r){s&&r&&s!==r&&e==="language"&&this.updateLanguage(r)}disconnectedCallback(){this.removeListeners()}setConstants=async()=>this.constants=await M(this.language);getConstants=e=>this.constants[e];removeListeners(){["logout","password"].forEach(e=>this.querySelector(`#${e}`)?.removeEventListener("click",this.handlers(e)?.handler)),this.innerHTML="",["ldod-login","ldod-logout"].forEach(e=>window.removeEventListener(e,this.updateComponent))}render(){g().user?this.appendChild(x()):this.appendChild(j()),this.addListeners(),this.updateLanguage()}updateComponent(){this.removeListeners(),this.render()}addListeners(){["logout","password"].forEach(e=>this.querySelector(`#${e}`)?.addEventListener("click",this.handlers(e).handler)),["ldod-login","ldod-logout"].forEach(e=>window.addEventListener(e,this.updateComponent))}async updateLanguage(){await this.setConstants(),this.querySelectorAll("a.update-language").forEach(e=>e.innerHTML=this.getConstants(e.id))}handlers(e){return{logout:{id:"logout",handler:()=>H()},password:{id:"password",handler:()=>console.log("password changed")}}[e]}}!customElements.get("user-component")&&customElements.define("user-component",L,{extends:"li"});const F=Object.freeze(Object.defineProperty({__proto__:null,UserComponent:L},Symbol.toStringTag,{value:"Module"}));await d(()=>Promise.resolve().then(()=>F),void 0).catch(()=>{});const y=async()=>await d(()=>import("./userRouter.a65636a5.js"),[]),D={path:"/user",mount:async(t,e)=>(await y()).mount(t,e),unMount:async()=>(await y()).unMount()};D.mount("en","#root");window.addEventListener("ldod-url-changed",({detail:{path:t}})=>{t==="/"&&(history.pushState({},void 0,"/"),document.querySelector("ldod-outlet").childNodes.forEach(e=>e.remove()))});window.addEventListener("ldod-loading",({detail:{isLoading:t}})=>{const e=document.querySelector("div#loading");e.ariaHidden=String(!t)});window.addEventListener("ldod-message",({detail:{message:t}})=>{const e=document.querySelector("div#message");e.innerHTML=t});window.addEventListener("ldod-error",({detail:{message:t}})=>{const e=document.querySelector("div#error");e.innerHTML=t});document.querySelector("#clear-message").addEventListener("click",V);document.querySelectorAll("button.lang").forEach(t=>{t.addEventListener("click",()=>document.querySelectorAll("[language]").forEach(e=>{e.setAttribute("language",t.id)}))});function V(){document.getElementById("message").innerHTML="",document.getElementById("error").innerHTML=""}export{d as _,h as a,G as b,J as c,Y as d,X as e,Q as f,Z as g,g as h,ne as i,M as l,ee as s,te as t};

import{sleep as e}from"@shared/utils.js";import{ldodEventBus as t}from"@shared/ldod-events.js";const r=e=>t.publish("ldod:loading",e),o="#table-tools{display:flex;justify-content:end;flex-wrap:wrap;column-gap:15px;padding-bottom:15px}input#table-search-field{width:30%;color:#555;background-color:#fff;margin:0;display:block;height:34px;padding:6px 12px;font:inherit;font-size:14px;line-height:1.42857143;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgb(0 0 0 / 8%);box-shadow:inset 0 1px 1px #00000014;-webkit-transition:border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;-o-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}input#table-search-field:focus{border-color:#777;outline:0;-webkit-box-shadow:inset 0 1px 1px rgb(0 0 0 / 8%),0 0 8px rgb(102 175 233 / 60%);box-shadow:inset 0 1px 1px #00000014,0 0 8px #66afe999}ldod-table table[id]>tbody>tr[searched]{display:table-row}ldod-table table[id]>tbody>tr:not([searched]){display:none}\n",a=Object.freeze(Object.defineProperty({__proto__:null,default:o},Symbol.toStringTag,{value:"Module"}));function l(e){const t=document.createElement("div");return t.innerHTML=`\n    <style>.table{width:100%;max-width:100%;margin-bottom:0!important;text-align:start}thead td{font-weight:700}.table th,.table td{padding:8px;vertical-align:top;border-top:1px solid #eceeef}.table thead th{vertical-align:middle;border-bottom:2px solid #eceeef}.table tbody+tbody{border-top:2px solid #eceeef}.table .table{background-color:#fff}.table-sm th,.table-sm td{padding:.3rem}.table-bordered{border-collapse:collapse;border-spacing:0;border:1px solid #eceeef}.table-bordered th,.table-bordered td{border:1px solid #eceeef}.table-bordered thead th,.table-bordered thead td{border-bottom-width:2px}.table-striped tbody tr:nth-of-type(odd){background-color:#0000000d}.table-hover tbody tr:hover{background-color:#00000013}.table-active,.table-active>th,.table-active>td{background-color:#00000013}.table-hover .table-active:hover{background-color:#00000013}.table-hover .table-active:hover>td,.table-hover .table-active:hover>th{background-color:#00000013}.table-success,.table-success>th,.table-success>td{background-color:#dff0d8}.table-hover .table-success:hover{background-color:#d0e9c6}.table-hover .table-success:hover>td,.table-hover .table-success:hover>th{background-color:#d0e9c6}.table-info,.table-info>th,.table-info>td{background-color:#d9edf7}.table-hover .table-info:hover{background-color:#c4e3f3}.table-hover .table-info:hover>td,.table-hover .table-info:hover>th{background-color:#c4e3f3}.table-warning,.table-warning>th,.table-warning>td{background-color:#fcf8e3}.table-hover .table-warning:hover{background-color:#faf2cc}.table-hover .table-warning:hover>td,.table-hover .table-warning:hover>th{background-color:#faf2cc}.table-danger,.table-danger>th,.table-danger>td{background-color:#f1b0b7}.table-hover .table-danger:hover{background-color:#f1b0b7}.table-hover .table-danger:hover>td,.table-hover .table-danger:hover>th{background-color:#f1b0b7}.thead-inverse th{color:#fff;background-color:#292b2c}.thead-default th{color:#464a4c;background-color:#eceeef}.table-inverse{color:#fff;background-color:#292b2c}.table-inverse th,.table-inverse td,.table-inverse thead th{border-color:#fff}.table-inverse.table-bordered{border:0}.table-responsive{display:block;width:100%;overflow-x:auto;-ms-overflow-style:-ms-autohiding-scrollbar}.table-responsive.table-bordered{border:0}.table-borderless th,.table-borderless td,.table-borderless thead th,.table-borderless tbody+tbody{border:0}.table-primary,.table-primary>th,.table-primary>td{background-color:#b8daff}.table-primary th,.table-primary td,.table-primary thead th,.table-primary tbody+tbody{border-color:#7abaff}.table-hover .table-primary:hover{background-color:#9fcdff}.table-hover .table-primary:hover>td,.table-hover .table-primary:hover>th{background-color:#9fcdff}.table-secondary,.table-secondary>th,.table-secondary>td{background-color:#d6d8db}.table-secondary th,.table-secondary td,.table-secondary thead th,.table-secondary tbody+tbody{border-color:#b3b7bb}.table-hover .table-secondary:hover{background-color:#c8cbcf}.table-hover .table-secondary:hover>td,.table-hover .table-secondary:hover>th{background-color:#c8cbcf}.table-success th,.table-success td,.table-success thead th,.table-success tbody+tbody{border-color:#8fd19e}.table-info th,.table-info td,.table-info thead th,.table-info tbody+tbody{border-color:#86cfda}.table-warning th,.table-warning td,.table-warning thead th,.table-warning tbody+tbody{border-color:#ffdf7e}.table-danger th,.table-danger td,.table-danger thead th,.table-danger tbody+tbody{border-color:#ed969e}.table-light,.table-light>th,.table-light>td{background-color:#fdfdfe}.table-light th,.table-light td,.table-light thead th,.table-light tbody+tbody{border-color:#fbfcfc}.table-hover .table-light:hover{background-color:#ececf6}.table-hover .table-light:hover>td,.table-hover .table-light:hover>th{background-color:#ececf6}.table-dark,.table-dark>th,.table-dark>td{background-color:#c6c8ca}.table-dark th,.table-dark td,.table-dark thead th,.table-dark tbody+tbody{border-color:#95999c}.table-hover .table-dark:hover{background-color:#b9bbbe}.table-hover .table-dark:hover>td,.table-hover .table-dark:hover>th{background-color:#b9bbbe}.table .thead-dark th{color:#fff;background-color:#343a40;border-color:#454d55}.table .thead-light th{color:#495057;background-color:#e9ecef;border-color:#dee2e6}.table-dark{color:#fff;background-color:#343a40}.table-dark th,.table-dark td,.table-dark thead th{border-color:#454d55}.table-dark.table-bordered{border:0}.table-dark.table-striped tbody tr:nth-of-type(odd){background-color:#ffffff0d}.table-dark.table-hover tbody tr:hover{color:#fff;background-color:#ffffff13}@media (max-width: 575.98px){.table-responsive-sm{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive-sm>.table-bordered{border:0}}@media (max-width: 767.98px){.table-responsive-md{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive-md>.table-bordered{border:0}}@media (max-width: 991.98px){.table-responsive-lg{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive-lg>.table-bordered{border:0}}@media (max-width: 1199.98px){.table-responsive-xl{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive-xl>.table-bordered{border:0}}.table-responsive>.table-bordered{border:0}table a{color:#0c4ef6!important;text-decoration:none;cursor:pointer}table a:hover{text-decoration:underline}.table-container{position:relative;clear:both;border:1px solid #ddd;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px}.table-body{overflow-x:auto;overflow-y:auto;height:100%}.th-inner{padding:8px;line-height:24px;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}\n</style>\n    <div id="table-tools">${e.searchKey?`\n      <style>${o}</style>\n      <input\n        id="table-search-field"\n        type="search"\n        name="search"\n        placeholder="search"\n      />\n  `:""}</div>\n    <div class="table-container">\n      <div class="table-body">\n        <table id=${e.id} class="${e.classes}">\n          <thead></thead>\n          <tbody></tbody>\n        </table>\n      </div>\n    </div> \n  `,t.querySelector("thead").appendChild(function(e,t){const r=document.createElement("tr");return r.append(...e.map((e=>{const r=document.createElement("th");return r.classList.add("th-inner"),r.setAttribute("data-key",e),s(r,t(e))}))),r}(e.headers,e.getConstants)),t.querySelector("tbody").append(...function(e){return e.data.length?d(e,0,e.interval):""}(e)),t.childNodes}function d(e,t,r){return e.data.slice(t,r).map((t=>(e.lastIndex+=1,b(t,e))))}function b(e,t){const r=e.data&&"function"==typeof e.data?e.data():e,o=document.createElement("tr");return o.toggleAttribute("searched",!0),o.setAttribute("id",e[t.searchKey]||""),o.append(...t.headers.map((e=>function(e){const t=document.createElement("td");let r="function"==typeof e?e():e;return s(t,r)}(r[e])))),o}function s(e,t){return t instanceof Node?e.appendChild(t):Symbol.iterator in Object(t)?e.append(...t):e.textContent=t||"",e.normalize(),e}let n;function i(){clearTimeout(n),n=void 0}class c extends HTMLElement{constructor(){super(),this.lastIndex=0,this.getRow=b.bind()}get classes(){return this.getAttribute("classes")}get numberOfVisibleRows(){return+(this.dataset.rows??20)}get isFullyLoaded(){return this.data.length<=this.numberOfVisibleRows||this.lastIndex===this.data.length}get interval(){return this.data.length<this.numberOfVisibleRows?this.data.length:this.numberOfVisibleRows}get language(){return this.getAttribute("language")}get searchKey(){return this.dataset.searchkey}get searchInput(){return this.querySelector("input#table-search-field")}get targetToObserve(){let e=this.querySelectorAll("table>tbody>tr"),t=e.length;return e[Math.floor(.75*t)]}static get observedAttributes(){return["language"]}get searchedRows(){return this.allRows.filter((e=>e.hasAttribute("searched")))}get unSearchedRows(){return this.allRows.filter((e=>!e.hasAttribute("searched")))}get allRows(){return Array.from(this.querySelectorAll("table>tbody>tr"))}connectedCallback(){this.render(),this.handleLazyRenderRows(),history.state?.searchTerm&&this.handleSearchInput()}render(){this.append(...l(this)),this.addEventListeners()}getConstants=e=>this.constants&&(this.language?this.constants[this.language][e]:this.constants[e])||e;addEventListeners=()=>{this.searchInput?.addEventListener("input",(()=>{return e=500,t=this.handleSearchInput,n&&i(),void(n=setTimeout((()=>{t(),i()}),e));var e,t}))};handleLazyRenderRows=()=>{this.isFullyLoaded||this.addObserver()};attributeChangedCallback(e,t,r){this.onChangeAttribute[e](t,r)}onChangeAttribute={language:(e,t)=>{e&&e!==t&&this.querySelectorAll("[data-key]").forEach((e=>{e.firstChild.textContent=this.getConstants(e.dataset.key)}))}};obsCallback=([e],t)=>{e.intersectionRatio>0&&(t.unobserve(e.target),this.addRows(),this.isFullyLoaded||t.observe(this.targetToObserve))};addObserver(){const e=new IntersectionObserver(this.obsCallback);return e.observe(this.targetToObserve),this.observer=e,e}addRows=e=>{const t=d(this,this.lastIndex,e??this.lastIndex+this.interval);this.querySelector("table>tbody").append(...t),this.dispatchCustomEvent("ldod-table-increased")};loadSearchStyle(){Promise.resolve().then((()=>a)).then((e=>{this.querySelector("#table-tools>style").innerHTML=e.default}))}handleSearchInput=async()=>{if(this.isSearching)return;this.isSearching=!0,r(!0),await e(10),this.isFullyLoaded||(this.observer.disconnect(),this.addRows(this.data.length));const t=this.querySelector("input#table-search-field").value?.trim().toLowerCase().toString();history.replaceState(t?{searchTerm:t}:{},{});const o=t?this.data.filter((e=>("string"==typeof e.search?e.search.toLowerCase():e.search.toString().toLowerCase()).includes(t))).map((e=>e[this.dataset.searchkey].toString())):this.data.map((e=>e[this.dataset.searchkey].toString()));this.querySelectorAll("tbody>tr").forEach((e=>e.toggleAttribute("searched",-1!==o.indexOf(e.id)))),this.dispatchCustomEvent("ldod-table-searched",{id:this.id,size:o.length}),r(!1),this.isSearching=!1};dispatchCustomEvent=(e,t)=>{this.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))}}!customElements.get("ldod-table")&&customElements.define("ldod-table",c);export{c as LdodTable};
